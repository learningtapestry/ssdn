parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"TC7z":[function(require,module,exports) {
"use strict";function e(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1;o<arguments.length;o++){var c=arguments[o];if(null!=c)for(var i in c)Object.prototype.hasOwnProperty.call(c,i)&&(n[i]=c[i])}return n}exports.__esModule=!0,exports.objectAssign=e,"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{configurable:!0,value:e,writable:!0});
},{}],"d5dd":[function(require,module,exports) {
"use strict";exports.__esModule=!0;
},{}],"MSgF":[function(require,module,exports) {
var define;
var t;!function(A,o){"function"==typeof t&&t.amd?t(["exports"],o):"object"==typeof exports?(o(exports),"object"==typeof module&&null!==module&&(module.exports=exports.uuid)):o(A.lil=A.lil||{})}(this,function(t){var A={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function o(){var t,A,o="";for(t=0;t<32;t++)A=16*Math.random()|0,8!==t&&12!==t&&16!==t&&20!==t||(o+="-"),o+=(12===t?4:16===t?3&A|8:A).toString(16);return o}function F(t,o){var F=A[o||"all"];return F&&F.test(t)||!1}o.isUUID=F,o.VERSION="0.1.0",t.uuid=o,t.isUUID=F});
},{}],"nE8H":[function(require,module,exports) {
"use strict";function e(e,t){var a=!1,n=!0,o=e.document,c=o.documentElement,d=o.addEventListener,l=d?"addEventListener":"attachEvent",r=d?"removeEventListener":"detachEvent",s=d?"":"on",i=function n(c){"readystatechange"===c.type&&"complete"!==o.readyState||(("load"===c.type?e:o)[r](s+c.type,n,!1),a||(a=!0,t.call(e,c.type||c)))};if("complete"===o.readyState)t.call(e,"lazy");else{if(!d&&c.doScroll){try{n=!e.frameElement}catch(y){}n&&function e(){try{c.doScroll("left")}catch(y){return void setTimeout(e,50)}i("poll")}()}o[l](s+"DOMContentLoaded",i,!1),o[l](s+"readystatechange",i,!1),e[l](s+"load",i,!1)}}exports.__esModule=!0,exports.contentLoaded=e;
},{}],"kXwH":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var n=require("./polyfills/contentLoaded"),e=function(n){return function(){for(var e=0,t=n;e<t.length;e++){(0,t[e])()}}};function t(e){return n.contentLoaded(window,e),function(){r(document,"DOMContentLoaded",e)}}function o(n){var t=[];return t.push(d(window,"focus",n)),exports.MODERN_BROWSER?(t.push(d(document,"visibilitychange",function(e){document.hidden||n.call(document,e)})),e(t)):e(t)}function i(n){var t=[];return t.push(d(window,"blur",function(e){document.hasFocus()||n.call(window,e)})),exports.MODERN_BROWSER?(t.push(d(document,"visibilitychange",function(e){document.hidden&&n.call(document,e)})),e(t)):e(t)}function d(n,e,t){return exports.MODERN_BROWSER?n.addEventListener(e,t):n.attachEvent("on"+e,t),function(){r(n,e,t)}}function r(n,e,t){exports.MODERN_BROWSER?n.removeEventListener(e,t):n.detachEvent("on"+e,t)}exports.MODERN_BROWSER=!!window.addEventListener,exports.onDOMContentLoaded=t,exports.onWindowVisible=o,exports.onWindowHidden=i,exports.addListener=d,exports.removeListener=r;
},{"./polyfills/contentLoaded":"nE8H"}],"Yoy7":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){return function(t,e){this.type="heartbeat",this.user=t,this.data=e}}();exports.HeartbeatMessage=t;
},{}],"yoSd":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){return function(e,t){this.type="video",this.user=e,this.data=t}}();exports.VideoMessage=e;
},{}],"Nsfw":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};exports.__esModule=!0;var t="https://learningtapestry.github.io/xapi/nucleus/collection/verbs/heartbeat",i={heartbeatId:"https://learningtapestry.github.io/xapi/nucleus/collection/extensions/heartbeatId",pageTitle:"https://learningtapestry.github.io/xapi/nucleus/collection/extensions/pageTitle",timeSpentOnPage:"https://learningtapestry.github.io/xapi/nucleus/collection/extensions/timeSpentOnPage"},n={ended:"http://adlnet.gov/expapi/verbs/completed",paused:"https://w3id.org/xapi/video/verbs/paused",playing:"https://w3id.org/xapi/video/verbs/played"},a=function(){function a(){}return a.prototype.encode=function(e){if("video"===e.type)return this.parseVideoMessage(e);if("heartbeat"===e.type)return this.parseHeartbeatMessage(e);throw new Error("Unknown messsage type.")},a.prototype.parseHeartbeatMessage=function(n){var a={account:e({name:n.user.id},n.user.extensions),objectType:"Agent"},r={id:t},o={definition:{type:"https://learningtapestry.github.io/xapi/nucleus/collection/activities/page"},id:n.data.pageUrl,objectType:"Activity"},s={extensions:{}};if(n.data)for(var p=0,c=Object.entries(n.data);p<c.length;p++){var u=c[p],d=u[0],l=u[1];i[d]&&(s.extensions[i[d]]=l)}return{actor:a,context:s,object:o,verb:r}},a.prototype.parseVideoMessage=function(t){var i={account:e({name:t.user.id},t.user.extensions),objectType:"Agent"},a={id:n[t.data.state]};return{actor:i,object:{definition:{type:"https://w3id.org/xapi/video/activity-type/video"},id:t.data.videoUrl,objectType:"Activity"},verb:a}},a}();exports.XApiEncoder=a;
},{}],"aiyf":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}exports.__esModule=!0,e(require("./heartbeatMessage")),e(require("./message")),e(require("./messageEncoder")),e(require("./videoMessage")),e(require("./xApiEncoder"));
},{"./heartbeatMessage":"Yoy7","./message":"d5dd","./messageEncoder":"d5dd","./videoMessage":"yoSd","./xApiEncoder":"Nsfw"}],"jA6Z":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){return function(){this.url=window.location.href,this.pageTitle=document.title}}();exports.PageContext=t;
},{}],"7PfU":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var t=e(require("lil-uuid")),a=require("../events"),i=require("../messages"),n=require("../pageContext"),r=function(){function e(e,i,n){var r=this;this.heartbeatId=t.default(),this.intervalId=0,this.lastHeartbeatTime=Date.now(),this.timeSpentOnPage=0,this.client=e,this.user=i,this.config=Object.assign({},{heartbeatInterval:2e3},n||{}),a.onDOMContentLoaded(function(e){r.enableHeartbeat()}),a.onWindowVisible(function(e){r.enableHeartbeat()}),a.onWindowHidden(function(e){r.disableHeartbeat()})}return e.prototype.sendHeartbeat=function(){if(0!==this.intervalId){var e=Date.now();this.timeSpentOnPage+=e-this.lastHeartbeatTime,this.lastHeartbeatTime=e;var t=new n.PageContext;this.client.sendMessage(new i.HeartbeatMessage(this.user,{heartbeatId:this.heartbeatId,pageTitle:t.pageTitle,pageUrl:t.url,timeSpentOnPage:Math.floor(this.timeSpentOnPage/1e3)}))}},e.prototype.enableHeartbeat=function(){var e=this;0!==this.intervalId&&window.clearInterval(this.intervalId),this.intervalId=window.setInterval(function(){return e.sendHeartbeat()},this.config.heartbeatInterval),this.sendHeartbeat()},e.prototype.disableHeartbeat=function(){window.clearInterval(this.intervalId),this.intervalId=0},e}();exports.HeartbeatCollector=r;
},{"lil-uuid":"MSgF","../events":"kXwH","../messages":"aiyf","../pageContext":"jA6Z"}],"8fVV":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../events"),t=require("../messages"),a=function(){function a(t,a){var n=this;this.players=[],this.client=t,this.user=a,window.onYouTubeIframeAPIReady&&(this.previousYTReady=window.onYouTubeIframeAPIReady),window.onYouTubeIframeAPIReady=this.onYouTubeIframeAPIReady.bind(this),this.onStateChange=this.onStateChange.bind(this),e.onDOMContentLoaded(function(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e),n.trackHtml5Videos()})}return a.prototype.onYouTubeIframeAPIReady=function(){this.previousYTReady&&this.previousYTReady();for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;t++)-1!==e[t].src.indexOf("youtube.com")&&this.players.push(new window.YT.Player(e[t],{autoplay:!1,events:{onStateChange:this.onStateChange}}))},a.prototype.trackHtml5Videos=function(){for(var e=this,t=document.getElementsByTagName("video"),a=function(a){var n=t[a];["playing","pause","ended"].forEach(function(t){n.addEventListener(t,function(a){var n=a.target,o=n.currentSrc.match(/^https?/)?n.currentSrc:n.baseURI;e.trackVideoEvent(t,o)},!0)})},n=0;n<t.length;n++)a(n)},a.prototype.onStateChange=function(e){var t;switch(e.data){case 5:t="cued";break;case 3:t="buffering";break;case 2:t="paused";break;case 1:t="playing";break;case 0:t="ended";break;case-1:t="unstarted";break;default:t="uncertain"}[0,1,2].includes(e.data)&&this.trackVideoEvent(t,e.target.getVideoUrl())},a.prototype.trackVideoEvent=function(e,a){this.client.sendMessage(new t.VideoMessage(this.user,{state:e,videoUrl:a}))},a}();exports.VideoCollector=a;
},{"../events":"kXwH","../messages":"aiyf"}],"+ryA":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}exports.__esModule=!0,e(require("./collector")),e(require("./heartbeatCollector")),e(require("./videoCollector"));
},{"./collector":"d5dd","./heartbeatCollector":"7PfU","./videoCollector":"8fVV"}],"5fY5":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t,n,o){this.baseUrl=e,this.apiKey=t,this.defaultNamespace=o,this.encoder=n}return e.prototype.sendMessage=function(e,t,n){void 0===n&&(n=this.defaultNamespace);var o=encodeURIComponent(JSON.stringify(this.encoder.encode(e))),i=document.createElement("img");i.onload=function(e){t&&t(void 0,void 0,i)},i.onerror=function(e){t&&t(!0,void 0,i)},i.src=this.buildUrl(o,n)},e.prototype.buildUrl=function(e,t){var n=[];return t&&n.push("ns="+t),n.push("aid="+this.apiKey,"event="+e),this.baseUrl+"/beacon?"+n.join("&")},e}();exports.ImageBeaconClient=e;
},{}],"6z0I":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./collectors"),r=require("./imageBeaconClient"),t=require("./messages/xApiEncoder"),o=function(){function o(e,r,t){this.client=e,this.collectors=r,this.user=t}return o.build=function(o){for(var s=new r.ImageBeaconClient(o.server,o.apiKey,new t.XApiEncoder,o.defaultNamespace),c=[],i=0,n=o.collectors;i<n.length;i++){var a=n[i];switch("[object Array]"===Object.prototype.toString.call(a)?a[0]:a){case"video":c.push(new e.VideoCollector(s,o.user));break;case"heartbeat":c.push(new e.HeartbeatCollector(s,o.user,a[1]))}}return new this(s,c,o.user)},o}();exports.Nucleus=o;
},{"./collectors":"+ryA","./imageBeaconClient":"5fY5","./messages/xApiEncoder":"Nsfw"}],"U7JD":[function(require,module,exports) {
"use strict";exports.__esModule=!0,require("./polyfills/objectAssign");var r=require("./nucleus"),e=function(r){for(var e={},s=0,u=r;s<u.length;s++){var n=u[s];e[n[0]]=n[1]}for(var i=[],o=0,t=["server","apiKey","collectors","user"];o<t.length;o++){var l=t[o];l in e||i.push("The "+l+" configuration is required.")}if(i.length>0)throw new Error("Nucleus options are invalid. Please review the following problems: "+i.join(","));return e},s=window.nucleus={Nucleus:r.Nucleus,_previousNucleus:window.nucleus,args:window.nucleus&&window.nucleus.args||[],configure:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];(this.args=this.args||[]).push(r)},bootstrap:function(s){return s=s||e(this.args),this.current=r.Nucleus.build(s),this.current}};s.args.length&&s.bootstrap();
},{"./polyfills/objectAssign":"TC7z","./nucleus":"6z0I"}]},{},["U7JD"], null)
//# sourceMappingURL=/agent.js.map