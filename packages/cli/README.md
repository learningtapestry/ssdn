# Nucleus CLI

The Nucleus CLI is a tool used to install and maintain an independent Nucleus instance.

## Installation instructions

_Note: these instructions are intended for end users wanting to set up a fresh installation of Nucleus on
their own AWS account. If you're a Nucleus developer, this is probably not for you. Stick to the
instructions offered in the `core` project, which is already linked to the AWS account and
infrastructure we use for development/testing purposes._

### Requirements

Before you're able to start the installation process, you need to make sure to install the following
software packages on your system:

- [Node.js](https://nodejs.org/en/). We recommend using version 8.15 or higher.
- [Yarn](https://yarnpkg.com/en/). Any version equal or higher than 1.15.x should work fine.
- [AWS CLI](https://aws.amazon.com/cli/). This is necessary to package and deploy the CloudFormation
  templates.
- [Amplify CLI](https://github.com/aws-amplify/amplify-cli). After you have installed Node.js and
  Yarn, you can execute `yarn global add @aws-amplify/cli`.

### Deployment steps

After you have installed the above packages, you can follow these steps in order to complete the
deployment of your Nucleus instance:

1. Create an [AWS account](https://aws.amazon.com), in case you haven't done it already.
2. Access the IAM section inside the AWS Console, and create a new user. You should grant it
   administrator access, or at least sufficient permissions to be able to create all the resources
   required by the Nucleus components.
3. Enable programatic access and don't forget to write down the `Access Key ID` and
   `Secret Access Key` values. You'll need them later when the Nucleus installer asks for them.
4. Go to the [Releases page on GitHub](https://github.com/learningtapestry/nucleus/releases/) and
   download the latest one.
5. Unzip the file to a folder of your choice.
6. Inside the unzipped folder, execute `yarn install`.
7. You can now start the installer by running `bin/nucleus install`. It will start asking you a few
   questions to configure your instance. In most of them, default values are provided and can be
   accepted by pressing `Enter`.
8. After the Core resources and the Administration Panel are properly deployed, you'll need to go
   back to your AWS console, access the Cognito User Pool generated by Amplify (it should start with
   `cognito...`) and create a new administrator user that will let you access the administrator
   panel.
9. Also in the AWS console, you need to attach a customer managed policy to the default authorized
   role that Amplify creates. This is necessary because by default this IAM role contains just a few
   permissions, and we need to add more in order to manage other resources from the admin panel. The
   name of the role should be something similar to `nucleus-admin-20190425203147-authRole`. The
   policy to attach is already created for you, and its name should start with
   `Nucleus-${ENVIRONMENT}-AdminPanelPolicy...` where `${ENVIRONMENT}` will match the environment
   you chose when running the installer. In most cases it will be `Production`.
10. Everything should be in place now. The last step is accessing the CloudFront section in the AWS
    console and noting the URL endpoint inside the Distribution that should have been generated. You
    can also see the value of this URL if you take a look at the last line of the `nucleus.log` file
    after deployment has completed.

Should the installer fail, a detailed log of the events will be stored in `nucleus.log`. After
you've addressed the problem, you can run the installer again and it will remember your answers to
the installer questions (they are stored in the file `.nucleus-config.json` in case you want to edit
them manually). Besides, even if you've already deployed the resources previously, running the
installer again will just update the CloudFormation stacks, and should not produce any side effect.
